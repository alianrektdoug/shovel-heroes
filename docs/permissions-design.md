# 鏟子英雄 - 權限設計文件

## 角色定義

### 1. 訪客 (guest)
- 未登入狀態模擬
- 只能瀏覽公開資訊

### 2. 一般用戶 (user)
- 已登入的一般志工

### 3. 網格管理員 (grid_manager)
- 負責管理特定區域的網格

### 4. 管理員 (admin)
- 系統管理員

### 5. 超級管理員 (super_admin)
- 最高權限管理員

---

## 新的權限設計規劃

### 📍 **導航頁面權限**

| 頁面 | 訪客 | 一般用戶 | 網格管理員 | 管理員 | 超級管理員 |
|------|------|----------|------------|--------|------------|
| 救援地圖 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 物資管理 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 志工中心 | ❌ | ✅ | ✅ | ✅ | ✅ |
| 管理後台 | ❌ | ✅ (受限) | ✅ (受限) | ✅ | ✅ |
| 關於我們 | ✅ | ✅ | ✅ | ✅ | ✅ |

---

## 📊 **管理後台功能權限詳細規劃**

### 1️⃣ **網格管理**

#### **一般用戶 (user)**
- ✅ **只能查看自己建立的網格**（不會看到他人建立的網格）
- ✅ 可以建立新網格
- ✅ 可以編輯**自己建立**的網格
- ✅ 可以刪除**自己建立**的網格（軟刪除到垃圾桶）
- ✅ 可以查看垃圾桶（只顯示自己刪除的網格）
- ✅ 可以還原自己的網格
- ✅ 可以批量選擇**自己建立**的網格
- ❌ 不可永久刪除

#### **網格管理員 (grid_manager)**
- ✅ 可以查看所有網格
- ✅ 可以建立新網格
- ✅ 可以編輯**所有網格**
- ✅ 可以將**所有網格**丟入垃圾桶
- ✅ 可以還原垃圾桶中的所有網格
- ✅ 可以查看垃圾桶
- ✅ 可以批量選擇和操作所有網格
- ❌ 不可永久刪除

#### **管理員 (admin)**
- ✅ 完整的網格管理權限
- ✅ 可以編輯所有網格
- ✅ 可以刪除所有網格（軟刪除）
- ✅ 可以還原所有網格
- ✅ 可以永久刪除
- ✅ 可以查看垃圾桶

#### **超級管理員 (super_admin)**
- ✅ 所有權限

---

### 2️⃣ **災區管理**

#### **一般用戶 (user)**
- ✅ 可以查看所有災區（唯讀）
- ❌ **不可建立災區**
- ❌ **不可編輯災區**
- ❌ **不可刪除災區**
- ❌ **不可看到垃圾桶**

#### **網格管理員 (grid_manager)**
- ✅ 可以查看所有災區
- ✅ 可以建立新災區
- ✅ 可以編輯災區
- ✅ 可以將災區丟入垃圾桶
- ✅ 可以還原災區
- ✅ 可以查看垃圾桶
- ❌ 不可永久刪除

#### **管理員 (admin)**
- ✅ 完整的災區管理權限
- ✅ 可以建立/編輯/刪除災區
- ✅ 可以永久刪除

#### **超級管理員 (super_admin)**
- ✅ 所有權限

---

### 3️⃣ **志工管理**

#### **一般用戶 (user)**
- ✅ 可以查看志工列表（唯讀）
- ❌ 不可編輯志工資訊
- ❌ 不可匯出

#### **網格管理員 (grid_manager)**
- ✅ 可以查看志工列表（唯讀）
- ❌ 不可編輯志工資訊
- ❌ 不可匯出

#### **管理員 (admin)**
- ✅ 可以查看志工列表
- ✅ 可以編輯志工資訊
- ✅ 可以匯出志工資料

#### **超級管理員 (super_admin)**
- ✅ 所有權限

---

### 4️⃣ **物資管理**

#### **一般用戶 (user)**
- ✅ 可以查看物資列表（唯讀）
- ❌ 不可編輯物資
- ❌ 不可匯出

#### **網格管理員 (grid_manager)**
- ✅ 可以查看物資列表（唯讀）
- ❌ 不可編輯物資
- ❌ 不可匯出

#### **管理員 (admin)**
- ✅ 可以查看物資列表
- ✅ 可以編輯物資
- ✅ 可以匯出物資資料
- ✅ 可以匯入物資資料

#### **超級管理員 (super_admin)**
- ✅ 所有權限

---

### 5️⃣ **用戶管理**

#### **一般用戶 (user)**
- ❌ 不可訪問

#### **網格管理員 (grid_manager)**
- ❌ 不可訪問

#### **管理員 (admin)**
- ✅ 可以查看用戶列表
- ✅ 可以編輯用戶角色

#### **超級管理員 (super_admin)**
- ✅ 所有權限

---

### 6️⃣ **系統公告管理**

#### **一般用戶 (user)**
- ✅ 可以查看公告（唯讀）
- ❌ 不可新增/編輯/刪除

#### **網格管理員 (grid_manager)**
- ✅ 可以查看公告（唯讀）
- ❌ 不可新增/編輯/刪除

#### **管理員 (admin)**
- ✅ 可以新增/編輯/刪除公告

#### **超級管理員 (super_admin)**
- ✅ 所有權限

---

### 7️⃣ **審計日誌**

#### **一般用戶 (user)**
- ❌ 不可訪問

#### **網格管理員 (grid_manager)**
- ❌ 不可訪問

#### **管理員 (admin)**
- ✅ 可以查看審計日誌
- ❌ 不可清除日誌

#### **超級管理員 (super_admin)**
- ✅ 可以查看審計日誌
- ✅ 可以清除日誌

---

## 🔄 **匯出/匯入權限總結**

| 功能 | 一般用戶 | 網格管理員 | 管理員 | 超級管理員 |
|------|----------|------------|--------|------------|
| 匯出網格 | ❌ | ✅ | ✅ | ✅ |
| 匯入網格 | ❌ | ✅ | ✅ | ✅ |
| 匯出災區 | ❌ | ✅ | ✅ | ✅ |
| 匯入災區 | ❌ | ✅ | ✅ | ✅ |
| 匯出志工 | ❌ | ❌ | ✅ | ✅ |
| 匯入志工 | ❌ | ❌ | ✅ | ✅ |
| 匯出物資 | ❌ | ❌ | ✅ | ✅ |
| 匯入物資 | ❌ | ❌ | ✅ | ✅ |

---

## 🗑️ **垃圾桶顯示權限**

| 角色 | 網格垃圾桶 | 災區垃圾桶 | 還原功能 | 永久刪除 |
|------|-----------|-----------|---------|---------|
| 一般用戶 | ✅ | ✅ | ✅ | ❌ |
| 網格管理員 | ✅ | ✅ | ✅ | ❌ |
| 管理員 | ✅ | ✅ | ✅ | ✅ |
| 超級管理員 | ✅ | ✅ | ✅ | ✅ |

---

## 📝 **建立者權限規則**

### 網格編輯權限矩陣

| 建立者角色 \ 編輯者角色 | 一般用戶 | 網格管理員 | 管理員 | 超級管理員 |
|----------------------|----------|------------|--------|------------|
| 一般用戶建立的網格 | ✅ (自己的) | ✅ | ✅ | ✅ |
| 網格管理員建立的網格 | ❌ | ✅ (自己的) | ✅ | ✅ |
| 管理員建立的網格 | ❌ | ❌ | ✅ | ✅ |
| 超級管理員建立的網格 | ❌ | ❌ | ❌ | ✅ |

---

## 實作建議

### 前端檢查
在 `Admin.jsx` 中新增權限檢查函數：
```javascript
// 檢查是否可以編輯特定網格
const canEditGrid = (grid) => {
  if (isSuperAdmin || isAdmin) return true;
  if (isGridManager) {
    // 可編輯自己的 + 一般用戶的
    return grid.created_by === user.id || grid.creator_role === 'user';
  }
  if (actingRole === 'user') {
    // 只能編輯自己建立的
    return grid.created_by === user.id;
  }
  return false;
};

// 檢查是否可以刪除特定網格
const canDeleteGrid = (grid) => {
  if (isSuperAdmin || isAdmin) return true;
  if (isGridManager) {
    return grid.created_by === user.id || grid.creator_role === 'user';
  }
  if (actingRole === 'user') {
    return grid.created_by === user.id;
  }
  return false;
};

// 檢查是否可以永久刪除
const canPermanentlyDelete = () => {
  return isSuperAdmin || isAdmin;
};
```

### 後端 API 權限檢查
需要在後端路由增加對應的權限驗證中間件。
